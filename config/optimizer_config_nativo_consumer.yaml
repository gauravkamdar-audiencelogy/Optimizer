# Optimizer Config: nativo_consumer (Consumer Targeting)
# ======================================================
# Run: python run_optimizer.py --config config/optimizer_config_nativo_consumer.yaml

dataset:
  name: "nativo_consumer"  # â†’ data_nativo_consumer/, output_nativo_consumer/

# -----------------------------------------------------------------------------
# WHAT TO CHANGE REGULARLY
# -----------------------------------------------------------------------------
business:
  target_win_rate: 0.65
  exploration_mode: true

technical:
  aggressive_exploration: false
  min_bid_cpm: 0.50            # Lower floor for consumer inventory
  max_bid_cpm: 20.00

bidding:
  strategy: "adaptive"

data:
  min_bid_date: "2025-11-01"
  min_view_date: "2025-11-01"

# -----------------------------------------------------------------------------
# NPI SETTINGS (nativo_consumer = consumer targeting = NO NPI data)
# -----------------------------------------------------------------------------
npi:
  enabled: false

# -----------------------------------------------------------------------------
# EXPLORATION PRESETS
# -----------------------------------------------------------------------------
exploration_presets:
  aggressive:
    bonus_zero_obs: 0.50
    bonus_low_obs: 0.35
    bonus_medium_obs: 0.15
    max_adjustment: 1.8
    max_bid_cpm: 30.00

  gradual:
    bonus_zero_obs: 0.25
    bonus_low_obs: 0.15
    bonus_medium_obs: 0.08
    max_adjustment: 1.4
    max_bid_cpm: 20.00

# -----------------------------------------------------------------------------
# FEATURES
# -----------------------------------------------------------------------------
features:
  anchor: [internal_adspace_id]

  candidates:
    - internal_adspace_id
    - geo_region_name
    - geo_country_code2
    - os_code
    - domain
    - browser_code
    - hour_of_day
    - day_of_week
    - media_type

  exclude:
    - geo_postal_code
    - geo_city_name
    - log_txnid
    - internal_txn_id
    - log_dt
    - ref_bundle              # URL field - too sparse
    - ua                      # User agent - too sparse

# -----------------------------------------------------------------------------
# ADVANCED
# -----------------------------------------------------------------------------
advanced:
  min_observations: 1
  min_observations_for_empirical: 10
  min_observations_for_landscape: 50
  min_win_rate_for_margin: 0.55
  min_observations_for_margin: 100
  shrinkage_k: 30
  calibration_ece_threshold: 0.10
  min_signal_score: 50.0
  max_features: 3
  default_bid_cpm: 5.00        # Lower default for consumer inventory
  floor_available: true        # Nativo has floor prices
  target_margin: 0.30

# -----------------------------------------------------------------------------
# VALIDATION (checks before deployment)
# -----------------------------------------------------------------------------
validation:
  enabled: true

  hard_rules:
    coverage_min_pct: 80.0
    calibration_ece_max: 0.15
    bid_floor_respected: true
    bid_ceiling_respected: true

  soft_rules:
    bid_median_change_max_pct: 50.0
    pct_at_floor_max: 30.0
    pct_at_ceiling_max: 30.0
    pct_profitable_min: 40.0

  previous_run_path: null
